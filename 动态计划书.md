## 任务书

### 3.22

后端

- done 开发后台的删除和更新博客的代码

前端

- done开发博客展示页面的 ui
- done开发前端编辑博客的逻辑

### 3.24

前端

- done 开发博客推荐气泡，展示标题 ***
- done 开发个人页面博客推荐气泡风格展示框 **
- 开发view 15s 埋点逻辑 **
- 开发评论功能的增删改查 *
- 开发我的粉丝，我关注的 页面 *

后端

- 开发后台推荐博客逻辑接口 ***
- 开发点赞埋点逻辑 **
- 开发评论功能的增删改查 *
- 开发关注、取关功能 *

评论部分数据结构与逻辑

后端添加评论逻辑：

1. 添加一级评论。创建新的评论记录，主要字段有：

   1. id，评论id（后端自动创建
   2. parent_level_id，父级评论id（进行一级评论的创建时，不给后端传递这个字段
   3. content，评论内容
   4. blog_id，所属博客的id
   5. user_id，评论者id
   6. commented_user_id，被评论者id（进行一级评论的创建时，不给后端传递这个字段
   7. username，评论者用户名，由于用户名可能会被修改，因此，用户名不由前端传递给后端，而是使用user_id进行查询获取
   8. commented_username，被评论者用户名，逻辑同上
   9. create_time，创建时间
   10. comment_privacy_level 隐私等级。公开、作者本人可见、
2. 添加二级评论。找到对应的一级评论，加入一级评论的子评论数组，根据传参，插入对应的位置（位置应为回复的子评论之后，如果没有传回复的目标子评论的id，则说明是第一个子评论，直接创建一个唯一的子评论id，并加入一级评论的子评论数组。）或者直接添加到子评论数组尾部，如果找不到一级评论，说明已经被删除，返回相关提示。

   1. secondary_id，评论id（后端自动创建，保证在子评论数组中唯一
   2. parent_level_id，父级评论id（进行一级评论的创建时，不给后端传递这个字段
   3. content，评论内容
   4. blog_id，所属博客的id
   5. user_id，评论者id
   6. commented_user_id，被评论者id（进行一级评论的创建时，不给后端传递这个字段
   7. username，评论者用户名，由于用户名可能会被修改，因此，用户名不由前端传递给后端，而是使用user_id进行查询获取
   8. commented_username，被评论者用户名，逻辑同上
   9. create_time，创建时间
   10. comment_privacy_level，二级评论跟随一级评论
3. 删除一级评论，找到对应的一级评论，直接删除记录，包括子评论数组
4. 删除二级评论，先找到对应的一级评论，然后使用secondary_id查找子评论数组中的该二级评论，删除。

隐私部分数据结构设计与逻辑

1. 默认基本隐私权限字段
   1. blog_privacy_level: 博客可见隐私设置。公开、仅作者本人可见，默认公开
   2. comment_privacy_level: 阅读者评论时的可见隐私设置。公开、仅作者本人可见，默认仅作者本人可见
   3. is_my_comment_public: 我评论时，评论的隐私程度。公开、仅作者可见。默认为仅作者可见
   4. is_commentable: 是否可评论，默认为可以
   5. done fans_parivacy: 粉丝列表是否可见，默认为否
   6. done following_privacy: 关注列表是否可见，默认为否
2. 单篇博客基本隐私权限字段
   1. blog_privacy_level: 博客可见隐私设置。公开、仅作者本人可见，默认公开
   2. comment_privacy_level: 阅读者评论时的可见隐私设置。公开、仅作者本人可见，默认仅作者本人可见
   3. done is_commentable: 是否可评论，默认为可以，作者和阅读者都不可评论，逻辑一致

### 推荐播客部分逻辑

首先获取用户的偏好字段：favor

根据比例挑选博客组成推荐列表

例如：

学习、日常、生活、美食、工作，分别占

0.40、0.20、0.20、0.10、0.10

1. 从学习标签开始筛选博客，首先，选取10篇学习相关的博客，然后，从中随机挑选4篇，放入结果数组，将已选取的博客的id进行另外的暂时存储。用于对之后的其他标签的博客的查询进行互斥计算（`SELECT*FROM my_table WHERE FIND_IN_SET(id, '1,2,3') =0;`)
2. 并且需要限制数量 而且需要是随机的（ `SELECT*FROM my_table ORDERBY RAND() LIMIT 10;）`
3. 每个标签依次进行如此处理，如果还没有满足数量要求，则随机进行查询（当然，对之前已选取的博客id进行互斥计算）

### 关注、取关逻辑

1. 关注时，关注按钮变为已关注按钮，用户粉丝数+1，本人关注数+1，用户fans列表id添加本人id，本人following列表id添加用户id
2. 取关时，已关注按钮变为关注按钮，用户粉丝数+1，本人关注数-1，用户fans列表id删除本人id，本人following列表id删除用户id

### 待开发

1. 隐私

   1. blog_privacy_level: 博客可见隐私设置。公开、仅作者本人可见，默认公开
   2. comment_privacy_level: 阅读者评论时的可见隐私设置。公开、仅作者本人可见，默认仅作者本人可见
   3. is_my_comment_public: 我评论时，评论的隐私程度。公开、仅作者可见。默认为仅作者可见
   4. 博客权限设置，可见度，评论区默认评论隐私设置，评论区是否开放
2. 粉丝和关注

   1. done 关注
   2. done 取关
   3. 粉丝关注列表页面tab开发
   4. 权限判断移到后端处理
3. done 内容推荐算法
